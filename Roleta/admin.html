<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de Administração da Roleta</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f0f2f5; color: #333; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; background: #fff; padding: 30px; border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #34495e; border-bottom: 2px solid #3498db; padding-bottom: 10px; margin-bottom: 20px; }
        .explanation-box { background-color: #e9f7fd; border: 1px solid #b3e5fc; border-radius: 8px; padding: 15px; margin-bottom: 30px; font-size: 0.95em; }
        .explanation-box h2 { margin-top: 0; color: #0277bd; font-size: 1.2em; }
        .explanation-box p { margin-bottom: 10px; line-height: 1.5; }
        .explanation-box code { background-color: #d1ecf1; padding: 2px 5px; border-radius: 4px; font-weight: bold; }
        .premios-grid { display: grid; grid-template-columns: 1fr; gap: 20px; margin-bottom: 30px; }
        .premio-item { display: grid; grid-template-columns: 2fr 1fr; gap: 15px; align-items: flex-end; }
        .premio-input label { margin-bottom: 5px; font-weight: bold; color: #555; }
        .premio-input input { padding: 10px; border: 1px solid #ccc; border-radius: 5px; font-size: 1em; width: 100%; box-sizing: border-box; }
        .premio-input input:focus { outline: none; border-color: #3498db; }
        .btn-container { text-align: center; }
        #salvar-btn { padding: 15px 40px; font-size: 1.2em; font-weight: bold; color: #fff; background-color: #27ae60; border: none; border-radius: 8px; cursor: pointer; transition: background-color 0.3s; }
        #salvar-btn:hover { background-color: #229954; }
        #salvar-btn:disabled { background-color: #95a5a6; cursor: not-allowed; }
        #confirmacao { text-align: center; margin-top: 20px; font-weight: bold; color: #27ae60; display: none; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Painel de Controle dos Prêmios</h1>
        <div class="explanation-box">
            <h2>Como funciona o sistema de "Peso":</h2>
            <p>O sistema de sorteio é baseado em pesos para controlar a probabilidade. A regra é simples: <strong>quanto maior o número no campo "Peso", maior a chance</strong> do prêmio ser sorteado.</p>
            <p>Um prêmio com peso <code>0</code> nunca será sorteado.</p>
        </div>
        <div id="premios-grid" class="premios-grid">
            <p>Carregando prêmios do Firebase...</p>
        </div>
        <div class="btn-container">
            <button id="salvar-btn" disabled>Salvar Configurações</button>
            <p id="confirmacao">✔ Prêmios salvos com sucesso no Firebase!</p>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, collection, doc, getDocs, writeBatch, query, orderBy } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

      // Your web app's Firebase configuration
const firebaseConfig = {
  apiKey: "AIzaSyB1t-A3oZ09sUqHFjWSGUAgD3BNwNfibSc",
  authDomain: "roleta-vip-sorteio.firebaseapp.com",
  projectId: "roleta-vip-sorteio",
  storageBucket: "roleta-vip-sorteio.firebasestorage.app",
  messagingSenderId: "486644585290",
  appId: "1:486644585290:web:e1916aba17c9dd864fa7b3"
};

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const premiosGrid = document.getElementById('premios-grid');
        const salvarBtn = document.getElementById('salvar-btn');
        const confirmacaoMsg = document.getElementById('confirmacao');
        let premiosCarregados = [];

        const carregarInputs = async () => {
            try {
                const q = query(collection(db, "premios"), orderBy("nome", "asc"));
                const querySnapshot = await getDocs(q);
                
                if (querySnapshot.empty) {
                    const batch = writeBatch(db);
                    for (let i = 1; i <= 15; i++) {
                        const premioNome = `Prêmio ${i}`;
                        const novoPremioRef = doc(collection(db, "premios"));
                        batch.set(novoPremioRef, { nome: premioNome, peso: 10 });
                    }
                    await batch.commit();
                    return carregarInputs();
                }

                premiosCarregados = [];
                querySnapshot.forEach((doc) => {
                    premiosCarregados.push({ id: doc.id, ...doc.data() });
                });

                premiosGrid.innerHTML = '';
                
                premiosCarregados.forEach((premio, i) => {
                    const itemDiv = document.createElement('div');
                    itemDiv.classList.add('premio-item');
                    itemDiv.innerHTML = `
                        <div class="premio-input">
                            <label for="nome-${i}">Prêmio:</label>
                            <input type="text" id="nome-${i}" value="${premio.nome}" data-doc-id="${premio.id}">
                        </div>
                        <div class="premio-input">
                            <label for="peso-${i}">Peso (Chance):</label>
                            <input type="number" id="peso-${i}" value="${premio.peso}" min="0">
                        </div>
                    `;
                    premiosGrid.appendChild(itemDiv);
                });
                salvarBtn.disabled = false;
            } catch (error) {
                console.error("Erro ao carregar prêmios: ", error);
                premiosGrid.innerHTML = '<p style="color:red;">Falha ao carregar prêmios do Firebase.</p>';
            }
        };

        const salvarPremios = async () => {
            salvarBtn.disabled = true;
            salvarBtn.textContent = 'Salvando...';
            try {
                const batch = writeBatch(db);
                for (let i = 0; i < premiosCarregados.length; i++) {
                    const nomeInput = document.getElementById(`nome-${i}`);
                    const docId = nomeInput.dataset.docId;
                    const nome = nomeInput.value;
                    const peso = parseInt(document.getElementById(`peso-${i}`).value, 10) || 0;
                    const premioRef = doc(db, "premios", docId);
                    batch.update(premioRef, { nome: nome, peso: peso });
                }
                await batch.commit();
                confirmacaoMsg.style.display = 'block';
                setTimeout(() => { confirmacaoMsg.style.display = 'none'; }, 3000);
            } catch (error) {
                console.error("Erro ao salvar prêmios: ", error);
                alert("Ocorreu um erro ao salvar.");
            } finally {
                salvarBtn.disabled = false;
                salvarBtn.textContent = 'Salvar Configurações';
            }
        };

        salvarBtn.addEventListener('click', salvarPremios);
        carregarInputs();
    </script>
</body>
</html>