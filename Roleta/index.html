<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roleta de Prêmios</title>
    <link rel="stylesheet" href="style.css">
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>

    <header class="user-header">
        <span id="user-email"></span>
    </header>

    <div class="main-container">
        <div id="painel-admin" class="controles" style="display: none;">
            <h3>Gerenciar Prêmios</h3>
            <div class="form-premio">
                <input type="text" id="nome-premio-input" placeholder="Nome do Prêmio">
                <input type="color" id="cor-premio-input" value="#3498db">
                <button id="add-premio-btn">Adicionar</button>
            </div>
            <h4>Lista de Prêmios Atuais</h4>
            <ul id="lista-premios"></ul>
        </div>

        <div class="container">
            <div class="roleta-container">
                <div class="seta"></div>
                <div class="roleta" id="roleta"></div>
            </div>
            <button id="girar-btn">Girar a Roleta!</button>
            <p id="giros-restantes"></p>
        </div>
    </div>

    <div class="historico-container">
        <h2>Seu Histórico de Prêmios</h2>
        <ul id="historico-lista"></ul>
    </div>

    <audio id="som-giro" src="spinning.mp3" loop></audio>
    <audio id="som-vitoria" src="win.mp3"></audio>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="firebase-config.js"></script>
    
    <script>
        // --- ELEMENTOS DO DOM ---
        const painelAdmin = document.getElementById('painel-admin');
        const userHeader = document.querySelector('.user-header');
        const userEmailSpan = document.getElementById('user-email');
        const girarBtn = document.getElementById('girar-btn');
        const girosRestantesP = document.getElementById('giros-restantes');
        const roleta = document.getElementById('roleta');
        const historicoListaUl = document.getElementById('historico-lista');
        const addPremioBtn = document.getElementById('add-premio-btn');
        const nomePremioInput = document.getElementById('nome-premio-input');
        const corPremioInput = document.getElementById('cor-premio-input');
        const listaPremiosUl = document.getElementById('lista-premios');
        const somGiro = document.getElementById('som-giro');
        const somVitoria = document.getElementById('som-vitoria');

        // --- VARIÁVEIS DE ESTADO ---
        let currentUser = null;
        let premios = [];

        // --- FUNÇÕES ---
        // (As funções como renderizarRoleta, carregarHistorico, etc. vão aqui)
        function renderizarRoleta() {
            // Implementação da função para desenhar a roleta
        }
        
        // --- INICIALIZAÇÃO E AUTENTICAÇÃO ---
        auth.onAuthStateChanged(async (user) => {
            if (user) {
                currentUser = user;
                userEmailSpan.textContent = `Logado como: ${user.email}`;

                // Lógica para verificar se é admin e mostrar o painel
                const userDocRef = db.collection('users').doc(user.uid);
                const doc = await userDocRef.get();
                if (doc.exists && doc.data().role === 'admin') {
                    painelAdmin.style.display = 'block';
                }
                
                // Adiciona o botão de logout
                if (!document.getElementById('btn-logout')) {
                    const logoutButton = document.createElement('button');
                    logoutButton.id = 'btn-logout';
                    logoutButton.textContent = 'Sair';
                    logoutButton.onclick = () => auth.signOut().then(() => { window.location.href = 'login.html'; });
                    userHeader.appendChild(logoutButton);
                }

            } else {
                window.location.href = 'login.html';
            }
        });

        // --- EVENT LISTENERS ---
        // A linha do erro original estava aqui, agora corrigida
        if (addPremioBtn) {
            addPremioBtn.addEventListener('click', async () => {
                // Lógica para adicionar prêmio
            });
        }
        
        if (girarBtn) {
            girarBtn.addEventListener('click', () => {
                // Lógica do giro da roleta
            });
        }
        
        if (listaPremiosUl) {
            listaPremiosUl.addEventListener('click', async (e) => {
               // Lógica para remover prêmio
            });
        }
    </script>
</body>
</html>