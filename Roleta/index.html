<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roleta de Prêmios</title>
    <link rel="stylesheet" href="style.css">
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>

    <header class="user-header">
        <span id="user-email"></span>
        </header>

    <div class="main-container">
        <div class="controles" style="display: none;">
            <h3>Painel de Controle da Roleta</h3>
            <div class="modo-controle">
                <label>
                    <input type="radio" name="modo" value="direto" checked> Controle Direto
                </label>
                <label>
                    <input type="radio" name="modo" value="probabilidade"> Controle por %
                </label>
            </div>
            <div class="selecao-container">
                <label for="premio-select">Escolha o Prêmio:</label>
                <select id="premio-select"></select>
            </div>
            <div id="probabilidade-container" class="hidden">
                <label for="porcentagem-input">Chance de Sair (%):</label>
                <input type="number" id="porcentagem-input" min="0" max="100" placeholder="Ex: 50">
            </div>
        </div>

        <div class="container">
            <div class="roleta-container">
                <div class="seta"></div>
                <div class="roleta" id="roleta"></div>
            </div>
            <button id="girar-btn">Girar a Roleta!</button>
        </div>
    </div>

    <audio id="som-giro" src="spinning.mp3" loop></audio>
    <audio id="som-vitoria"src="win.mp3"></audio>


    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="firebase-config.js"></script>
    
    <script>
        const painelDeControles = document.querySelector('.controles');
        const userHeader = document.querySelector('.user-header');
        const userEmailSpan = document.getElementById('user-email');
        const girarBtn = document.getElementById('girar-btn');
        const roleta = document.getElementById('roleta');
        
        // Pegando os elementos de áudio
        const somGiro = document.getElementById('som-giro');
        const somVitoria = document.getElementById('som-vitoria');
        
        let isGirando = false;

        auth.onAuthStateChanged(user => {
            if (user) {
                userEmailSpan.textContent = `Logado como: ${user.email}`;
                adicionarBotaoLogout(userHeader);

                const userDocRef = db.collection('users').doc(user.uid);
                userDocRef.get().then((doc) => {
                    if (doc.exists && doc.data().role === 'admin') {
                        painelDeControles.style.display = 'block';
                    }
                });
            } else {
                window.location.href = 'login.html';
            }
        });
        
        // --- Lógica do Giro da Roleta ---
        girarBtn.addEventListener('click', () => {
            if (isGirando) return;
            
            isGirando = true;
            girarBtn.disabled = true;
            girarBtn.textContent = 'Girando...';
            somGiro.play(); // Toca o som de giro

            // Simula a escolha de um prêmio (por enquanto, aleatório)
            // TODO: Substituir pela lógica de prêmio controlado na Parte 2
            const premios = ['Prêmio 1', 'Prêmio 2', 'Prêmio 3', 'Prêmio 4', 'Prêmio 5', 'Prêmio 6', 'Prêmio 7', 'Prêmio 8', 'Prêmio 9', 'Prêmio 10', 'Prêmio 11', 'Prêmio 12', 'Prêmio 13', 'Prêmio 14', 'Prêmio 15', 'Prêmio 16', 'Prêmio 17', 'Prêmio 18', 'Prêmio 19', 'Tente Novamente'];
            const premioVencedor = premios[Math.floor(Math.random() * premios.length)];

            // --- Animação e Resultado ---
            // Esta lógica de ângulo será aprimorada na Parte 2
            const anguloFinal = Math.floor(Math.random() * 360) + 3600; // Gera voltas aleatórias
            roleta.style.transition = 'transform 5s cubic-bezier(0.25, 0.1, 0.25, 1)';
            roleta.style.transform = `rotate(${anguloFinal}deg)`;

            // Aguarda a animação terminar
            setTimeout(() => {
                somGiro.pause(); // Para o som de giro
                somGiro.currentTime = 0; // Reinicia o áudio para o próximo giro
                somVitoria.play(); // Toca o som de vitória

                // Exibe o modal elegante com o resultado
                Swal.fire({
                    icon: 'success',
                    title: 'Parabéns!',
                    html: `Você ganhou: <b>${premioVencedor}</b>`
                });

                isGirando = false;
                girarBtn.disabled = false;
                girarBtn.textContent = 'Girar a Roleta!';
            }, 5500); // Tempo um pouco maior que a animação da roleta
        });


        function adicionarBotaoLogout(container) {
            if (document.getElementById('btn-logout')) return;
            const logoutButton = document.createElement('button');
            logoutButton.id = 'btn-logout';
            logoutButton.textContent = 'Sair';
            logoutButton.onclick = () => { auth.signOut().then(() => { window.location.href = 'login.html'; }); };
            container.appendChild(logoutButton);
        }
    </script>
    
    <script src="script.js"></script>
</body>
</html>